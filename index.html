<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JPG to PDF Converter</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- jsPDF library for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Custom styles for the Inter font and a smooth experience */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom file input button style */
        .custom-file-button input[type="file"] {
            display: none;
        }
        /* Simple spinner animation */
        .spinner {
            border-top-color: transparent;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-2xl bg-white rounded-2xl shadow-xl p-6 md:p-8">
        <div class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900">JPG to PDF Converter</h1>
            <p class="text-gray-500 mt-2">Combine multiple JPG images into a single PDF file.</p>
        </div>

        <!-- File Upload Section -->
        <div class="mb-6">
            <div class="custom-file-button">
                <label for="file-upload" class="w-full flex items-center justify-center px-6 py-4 text-base font-medium text-white bg-blue-600 rounded-lg cursor-pointer hover:bg-blue-700 transition-colors duration-300 shadow-md">
                    <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
                    Select JPG Images
                </label>
                <input id="file-upload" type="file" accept="image/jpeg,image/jpg" multiple>
            </div>
            <p id="file-count" class="text-center text-sm text-gray-500 mt-3"></p>
        </div>

        <!-- Image Preview Section -->
        <div id="image-preview-container" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 mb-6 min-h-[100px] bg-gray-50 p-4 rounded-lg border border-dashed">
            <p id="preview-placeholder" class="col-span-full text-center text-gray-400 self-center">Image previews will appear here</p>
        </div>

        <!-- Conversion Button -->
        <div class="text-center">
            <button id="convert-btn" class="w-full md:w-auto bg-green-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-green-700 transition-colors duration-300 disabled:bg-gray-400 disabled:cursor-not-allowed shadow-md flex items-center justify-center mx-auto" disabled>
                <span id="btn-text">Convert to PDF</span>
                <div id="spinner" class="spinner w-5 h-5 rounded-full border-2 border-white border-t-transparent ml-3 hidden"></div>
            </button>
        </div>

        <!-- Message Box -->
        <div id="message-box" class="mt-6 p-4 text-center rounded-lg hidden"></div>

    </div>

    <script>
        // Ensure jsPDF is loaded before we use it
        window.jsPDF = window.jspdf.jsPDF;

        // DOM element references
        const fileUpload = document.getElementById('file-upload');
        const imagePreviewContainer = document.getElementById('image-preview-container');
        const previewPlaceholder = document.getElementById('preview-placeholder');
        const convertBtn = document.getElementById('convert-btn');
        const fileCount = document.getElementById('file-count');
        const btnText = document.getElementById('btn-text');
        const spinner = document.getElementById('spinner');
        const messageBox = document.getElementById('message-box');

        let selectedFiles = [];

        // Event listener for file selection
        fileUpload.addEventListener('change', (event) => {
            selectedFiles = Array.from(event.target.files);
            updatePreview();
            updateConvertButtonState();
        });

        /**
         * Updates the image preview section with selected files.
         */
        function updatePreview() {
            // Clear previous previews
            imagePreviewContainer.innerHTML = '';

            if (selectedFiles.length === 0) {
                imagePreviewContainer.innerHTML = '<p id="preview-placeholder" class="col-span-full text-center text-gray-400 self-center">Image previews will appear here</p>';
                fileCount.textContent = '';
                return;
            }

            fileCount.textContent = `${selectedFiles.length} image(s) selected.`;

            // Create and append image previews
            selectedFiles.forEach(file => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const imgWrapper = document.createElement('div');
                    imgWrapper.className = 'relative aspect-square rounded-lg overflow-hidden border';
                    
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.className = 'w-full h-full object-cover';
                    img.alt = 'Image preview';
                    
                    imgWrapper.appendChild(img);
                    imagePreviewContainer.appendChild(imgWrapper);
                };
                reader.readAsDataURL(file);
            });
        }

        /**
         * Enables or disables the convert button based on file selection.
         */
        function updateConvertButtonState() {
            convertBtn.disabled = selectedFiles.length === 0;
        }

        /**
         * Displays a message to the user.
         * @param {string} message - The message to display.
         * @param {string} type - 'success' or 'error'.
         */
        function showMessage(message, type = 'success') {
            messageBox.textContent = message;
            messageBox.className = `mt-6 p-4 text-center rounded-lg ${type === 'success' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`;
            messageBox.classList.remove('hidden');
        }

        /**
         * Main function to convert images to PDF.
         */
        async function convertToPdf() {
            if (selectedFiles.length === 0) {
                showMessage('Please select images first.', 'error');
                return;
            }

            // Update UI to show loading state
            convertBtn.disabled = true;
            spinner.classList.remove('hidden');
            btnText.textContent = 'Converting...';
            messageBox.classList.add('hidden');

            try {
                const doc = new jsPDF();

                for (let i = 0; i < selectedFiles.length; i++) {
                    const file = selectedFiles[i];
                    const imgData = await readFileAsDataURL(file);
                    const img = await loadImage(imgData);

                    const imgWidth = img.width;
                    const imgHeight = img.height;

                    // Get PDF page dimensions
                    const pdfWidth = doc.internal.pageSize.getWidth();
                    const pdfHeight = doc.internal.pageSize.getHeight();

                    // Calculate image aspect ratio
                    const ratio = imgWidth / imgHeight;

                    // Calculate the dimensions to fit the image on the page
                    let newWidth = pdfWidth;
                    let newHeight = newWidth / ratio;

                    if (newHeight > pdfHeight) {
                        newHeight = pdfHeight;
                        newWidth = newHeight * ratio;
                    }
                    
                    // Center the image on the page
                    const x = (pdfWidth - newWidth) / 2;
                    const y = (pdfHeight - newHeight) / 2;

                    if (i > 0) {
                        doc.addPage();
                    }

                    doc.addImage(imgData, 'JPEG', x, y, newWidth, newHeight);
                }

                // Save the PDF
                doc.save('converted-images.pdf');
                showMessage('PDF created successfully! Check your downloads.', 'success');

            } catch (error) {
                console.error('Error during PDF conversion:', error);
                showMessage('An error occurred during conversion. Please try again.', 'error');
            } finally {
                // Reset UI from loading state
                convertBtn.disabled = false;
                spinner.classList.add('hidden');
                btnText.textContent = 'Convert to PDF';
                updateConvertButtonState();
            }
        }

        /**
         * Reads a file and returns its Data URL.
         * @param {File} file - The file to read.
         * @returns {Promise<string>} A promise that resolves with the file's data URL.
         */
        function readFileAsDataURL(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = (error) => reject(error);
                reader.readAsDataURL(file);
            });
        }

        /**
         * Creates an Image object from a data URL to get its dimensions.
         * @param {string} src - The image data URL.
         * @returns {Promise<HTMLImageElement>} A promise that resolves with the loaded image element.
         */
        function loadImage(src) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.onload = () => resolve(img);
                img.onerror = (error) => reject(error);
                img.src = src;
            });
        }

        // Attach event listener to the convert button
        convertBtn.addEventListener('click', convertToPdf);

    </script>
</body>
</html>
